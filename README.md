# rocksdb
![](https://dbdb.io/media/logos/rocksdb.png)
## Домашняя работа №4.
**Цель:** Научиться разбираться в любой СУБД зная только ее название. 
**Описание/ инструкция выполнения домашнего задания:**
Вам необходимо сделать отчет и ответить на следующие вопросы. Ответы должны быть развернуты и желательно с рисунками или примерами кода.
1. История развития СУБД
2. Инструменты для взаимодействия с СУБД
3. Какой database engine используется в вашей СУБД?
4. Как устроен язык запросов в вашей СУБД? Разверните БД с данными и выполните ряд запросов. 
5. Распределение файлов БД по разным носителям?
6. На каком языке/ах программирования написана СУБД?
7. Какие типы индексов поддерживаются в БД? Приведите пример создания индексов.
8. Как строится процесс выполнения запросов в вашей СУБД?
9. Есть ли для вашей СУБД понятие «план запросов»? Если да, объясните, как работает данный этап.
10. Поддерживаются ли транзакции в вашей СУБД? Если да, то расскажите о нем. Если нет, то существует ли альтернатива?
11. Какие методы восстановления поддерживаются в вашей СУБД. Расскажите о них.
12. Расскажите про шардинг в вашей конкретной СУБД. Какие типы используются? Принцип работы.
13. Возможно ли применить термины Data Mining, Data Warehousing и OLAP в вашей СУБД?
14. Какие методы защиты поддерживаются вашей СУБД? Шифрование трафика, модели авторизации и т.п.
15. Какие сообщества развивают данную СУБД? Кто в проекте имеет права на коммит и создание дистрибутива версий? Расскажите об этих людей и/или компаниях.
16. Создайте свои собственные данные для демонстрации работы СУБД. 
17. Как продолжить самостоятельное изучение языка запросов с помощью демобазы. Если демобазы нет, то создайте ее.
18. Где найти документацию и пройти обучение
19. Как быть в курсе происходящего

### История развития СУБД

RocksDB — это высокопроизводительный, постоянный механизм хранения ключей и значений, созданный Facebook* в 2012 году на основе кодовой базы LevelDB от Google.
В 2000-ных началось распространение твердотельных накопителей,устройства с малой задержкой и высокой пропускной способностью, для обслуживания онлайн-данных. SSD предлагает сотни тысяч операций ввода-вывода в секунду и может поддерживать пропускную способность в сотни МБ. Тем не менее, высокая пропускная способность записи не может поддерживаться из-за ограниченного количества циклов программирования/стирания. Эти факторы дают возможность переосмыслить структуры данных механизма хранения, чтобы оптимизировать их для этого оборудования. Разработчики хотели создать гибкое хранилище ключей и значений, чтобы обслуживать широкий спектр приложений, используя локальные SSD-накопители, при этом оптимизируя характеристики SSD-накопителей.

Изначально в компании, при разработке RocksDB, сосредоточились на экономии циклов стирания флэш-памяти и, следовательно, на повышении скорости записичем 
После нескольких лет разработки было замечено, что для большинства приложений использование пространства было гораздо более важным, чем повышение скорости записи, и в результате разработчики сместили цель оптимизации ресурсов на дисковое пространство.

### Инструменты для взаимодействия с СУБД


### Какой database engine используется в вашей СУБД?
RocksDB - использует log-structured storage engine.  
**Log-structured storage engine(LSM-деревья):**  
log-structured storage engine индексирует данные в 2 структуры данных:
1. Сбалансированная древовидная структура(memtable)
2. Набор сегментов хранения(Sorted String Table)  
Каждый сегмент представляет собой отсортированную коллекцию пар ключ-значение.
![](http://mezhov.com/images/posts/2013/sstable-lsm-tree.png)
![](https://mdimg.wxwenku.com/getimg/6b990ce30fa9193e296dd37902816f4bf6ef73cf382bd0f1c3a09b99598de4751eb31605b86145793fbf5cdbdab9edfb.jpg)
Вот несколько свойств SSTables:
1. Ключи сортируются в определенном сегменте.
2. Конкретный ключ может появиться только один раз в конкретном сегменте.
3. Ключ может повторяться в нескольких сегментах, но должен быть уникальным в конкретном сегменте.
4. Размер SSTables зависит от количества содержащихся в нем ключей, поэтому разные SSTables могут иметь разные размеры.
**Как обрабатываются записи?**
После поступления записи:
1. Запись добавляется в memtable
2. Каждый раз, когда размер memtable превышает какое-то значение, он сбрасывается на диск в отсортированном ввиде в SSTable
**Как обрабатываются чтения?**
1. Сначала memtable сканируется на наличие ключа. Если найдено, возвращается значение.
2. Иначе, ключ ищется в последнем сегменте, если там нет, то в предпоследней и т.д.  
### Как устроен язык запросов в вашей СУБД? Разверните БД с данными и выполните ряд запросов. 


### Распределение файлов БД по разным носителям?


### На каком языке/ах программирования написана СУБД?
  RocksDB — это библиотека C++

### Какие типы индексов поддерживаются в БД? Приведите пример создания индексов.


### Как строится процесс выполнения запросов в вашей СУБД?


### Есть ли для вашей СУБД понятие «план запросов»? Если да, объясните, как работает данный этап.


### Поддерживаются ли транзакции в вашей СУБД? Если да, то расскажите о нем. Если нет, то существует ли альтернатива?
RocksDB поддерживает транзакции при использовании <code>TransactionDB</code> или <code>OptimisticTransactionDB</code>(pessimistic и optimistic concurrency control).  
**_Optimistic concurrency control(OCC)_** - это метод управления параллелизмом, применяемый к транзакционным системам. OCC предполагает, что несколько транзакций часто могут выполняться, не мешая друг другу. Во время выполнения транзакции используют ресурсы данных, не блокируя эти ресурсы. Перед фиксацией каждая транзакция проверяет, что никакая другая транзакция не изменила прочитанные ею данные. Если проверка выявляет конфликтующие модификации, фиксирующая транзакция откатывается и может быть перезапущена.  
**_Pessimistic concurrency control(PCC)_** - это метод управления параллелизмом, применяемый к транзакционным системам. PCC предполагает худшее — что два или более пользователей захотят обновить одну и ту же запись одновременно, а затем предотвращает эту возможность, блокируя запись, нет. независимо от того, насколько маловероятны конфликты на самом деле. Блокировки устанавливаются, как только осуществляется доступ к любой части строки, что делает невозможным одновременное обновление строки двумя или более пользователями. В зависимости от режима блокировки ( совместно используемого , монопольного или обновляемого ) другие пользователи могут читать данные, даже если на них установлена блокировка.  
**TransactionDB**
При использовании <code>TransactionDB</code> все записанные ключи блокируются внутри RocksDB для обнаружения конфликтов. Если ключ не может быть заблокирован, операция вернет ошибку. Когда транзакция зафиксирована, она гарантированно будет успешной до тех пор, пока в базу данных можно будет производить запись. <code>TransactionDB</code> может быть лучше для рабочих нагрузок с большим параллелизмом по сравнению с <code>OptimisticTransactionDB</code>. Однако при использовании <code>TransactionDB</code> возникают небольшие затраты на блокировку.А также <code>TransactionDB</code> выполняет проверку конфликтов для всех операций записи (<code>Put</code>, <code>Delete</code></code> и <code>Merge</code>), включая записи, выполняемые вне транзакции.  
**OptimisticTransactionDB**
Оптимистичные транзакции обеспечивают упрощенное управление оптимистичным параллелизмом для рабочих нагрузок, которые не предполагают высокой конкуренции/интерференций между несколькими транзакциями.Оптимистичные транзакции не блокируются при подготовке к записи. Вместо этого они полагаются на обнаружение конфликтов во время фиксации, чтобы убедиться, что никакие другие писатели не изменили ключи, записываемые текущей транзакцией. Если есть конфликт с другой записью (или он не может быть определен), коммит вернет ошибку и никакие ключи не будут записаны.Оптимистичный контроль параллелизма полезен для многих рабочих нагрузок, которым требуется защита от случайных конфликтов записи. Однако это может быть не лучшим решением для рабочих нагрузок, где часто возникают конфликты записи из-за того, что множество транзакций постоянно пытаются обновить одни и те же ключи. Для этих рабочих нагрузо лучше подходит использование <code>TransactionDB</code>. <code>OptimisticTransactionDB</code> может быть более производительным, чем  <code>TransactionDB</code> для рабочих нагрузок с большим количеством нетранзакционных операций записи и небольшим количеством транзакций.
**Чтение из транзакции**  
Транзакции также поддерживают легкое чтение состояния ключей, которые в данный момент объединены в данную транзакцию, но еще не зафиксированы.  
**Защита от конфликтов чтения-записи**  
Если эта транзакция была создана с помощью <code>TransactionDB</code>, то либо тайм-аут, либо блокировка до тех пор, пока транзакция не будет зафиксирована или прервана. Если бы эта транзакция была создана с помощью <code>OptimisticTransactionDB</code>, то транзакция завершилась бы успешно, но при Commit вызове транзакция завершилась бы ошибкой.  
**Setting a Snapshot**  
По умолчанию проверка конфликтов транзакций подтверждает, что никто другой не записал ключ после того, как ключ был впервые записан в этой транзакции. Этой гарантии изоляции достаточно для многих случаев использования.

### Какие методы восстановления поддерживаются в вашей СУБД. Расскажите о них.

Данные большинства приложений RocksDB реплицируются на нескольких хостах, и часто они выполняют проверки согласованности, сравнивая контрольные суммы реплик. При обнаружении несоответствия контрольной суммы поврежденная реплика отбрасывается и заменяется правильной. Однако это жизнеспособный вариант только до тех пор, пока правильная реплика все еще существует и доступна. Сегодня RocksDB выполняет контрольные суммы файловых данных на нескольких уровнях, чтобы выявить повреждения, которые могли произойти в нижележащих слоях.

Блочные контрольные суммы, унаследованные от LevelDB, предотвращают раскрытие клиенту данных, поврежденных в файловой системе или ниже. В частности, к каждому блоку SSTable или фрагменту WAL прикреплена контрольная сумма, генерируемая при создании данных. В отличие от контрольной суммы файла, которая проверяется только при перемещении файла, эта контрольная сумма проверяется каждый раз при чтении блока либо для обслуживания запроса от приложения, либо для сжатия из-за меньшего объема.

Контрольные суммы файлов SSTable, добавленные в 2020 году, защищают от повреждения, вызванного базовой системой хранения, от распространения на другие реплики, а также от повреждения, вызванного в процессе передачи файлов SSTable по сети. Таким образом, каждая SSTable защищена собственной контрольной суммой, генерируемой при создании таблицы. Контрольная сумма SSTable записывается в записи файла метаданных SSTable и проверяется с помощью файла SSTable, куда бы он ни передавался. 
### Расскажите про шардинг в вашей конкретной СУБД. Какие типы используются? Принцип работы.


### Возможно ли применить термины Data Mining, Data Warehousing и OLAP в вашей СУБД?


### Какие методы защиты поддерживаются вашей СУБД? Шифрование трафика, модели авторизации и т.п


### Какие сообщества развивают данную СУБД? Кто в проекте имеет права на коммит и создание дистрибутива версий? Расскажите об этих людях и/или компаниях.
RocksDB разрабатывается и поддерживается командой разработчиков баз данных Facebook*.


Facebook* - крупнейшая социальная сеть в мире, основанная в 2004 году Марком Цукербергом и его соседями по комнате во время обучения в Гарвардском университете.
Facebook* позволяет создать профиль с фотографией и информацией о себе, приглашать друзей, обмениваться с ними сообщениями, изменять свой статус, оставлять сообщения на своей и чужой «стенах», загружать фотографии и видеозаписи, создавать группы (сообщества по интересам).

![Mark Zuckerberg](https://github.com/FAnastasiaF/rocksdb/blob/main/Mark_Zuckerberg_Facebook_page.png)

*\*Meta, которая владеет Facebook и Instagram, признана экстремистской организацией на территории России.*  

### Создайте свои собственные данные для демонстрации работы СУБД. 


### Как продолжить самостоятельное изучение языка запросов с помощью демобазы. Если демобазы нет, то создайте ее.


### Где найти документацию и пройти обучение
Вся документация находится по ссылке: https://github.com/facebook/rocksdb/wiki

### Как быть в курсе происходящего
Информация на официальном гитхабе: https://github.com/facebook/rocksdb
Вопросы и обсуждения приветствуются в общедоступной группе [RocksDB Developers](https://www.facebook.com/groups/rocksdb.dev/) на Facebook* и в [списке адресов электронной почты](https://groups.google.com/g/rocksdb) в группах Google.



*\*Meta, которая владеет Facebook и Instagram, признана экстремистской организацией на территории России.*  
 
